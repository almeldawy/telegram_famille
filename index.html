<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ABI - Signature Elite</title>
    
    <!-- Meta tags pour le mode Web App -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ABI Elite">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#020617">
    
    <!-- Ic√¥nes (doivent √™tre pr√©sentes √† la racine de ton d√©p√¥t GitHub) -->
    <link rel="icon" type="image/png" href="web-app-manifest-192x192.png">
    <link rel="apple-touch-icon" href="web-app-manifest-192x192.png">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;400;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-night: #020617;
            --card-night: rgba(15, 23, 42, 0.8);
            --accent-gold: #c5a059;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --glass-border: rgba(255, 255, 255, 0.1);
            --card-light: rgba(255, 255, 255, 0.8);
        }

        body.night-mode {
            background: radial-gradient(circle at 0% 0%, #1e293b 0%, #020617 100%);
            color: var(--text-main);
        }

        body {
            background: radial-gradient(circle at 100% 100%, #cbd5e1 0%, #f1f5f9 100%);
            color: #0f172a;
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden; 
            padding: 20px;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: manipulation;
        }

        .dashboard {
            width: 100%;
            max-width: 440px;
            background: var(--card-light);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 45px;
            padding: 40px 30px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
            position: relative;
            transition: all 0.6s ease;
        }

        body.night-mode .dashboard {
            background: var(--card-night);
            border: 1px solid var(--glass-border);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header span {
            font-size: 0.7rem;
            letter-spacing: 5px;
            font-weight: 800;
            color: var(--accent-gold);
            text-transform: uppercase;
            display: block;
            margin-bottom: 5px;
        }

        .header h2 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 0 10px;
        }

        .status-pill {
            background: rgba(0, 0, 0, 0.04);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        body.night-mode .status-pill {
            background: rgba(255, 255, 255, 0.05);
            color: #94a3b8;
        }

        #theme-toggle {
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--accent-gold);
            border-radius: 50%;
            color: white;
            box-shadow: 0 10px 15px rgba(197, 160, 89, 0.3);
            transition: 0.4s;
            font-size: 1.2rem;
            border: none;
        }

        textarea {
            width: 100%;
            background: rgba(0, 0, 0, 0.03);
            border: 1.5px solid rgba(0, 0, 0, 0.05);
            border-radius: 25px;
            padding: 20px;
            color: inherit;
            font-family: inherit;
            font-size: 1rem;
            resize: none;
            box-sizing: border-box;
            outline: none;
            transition: 0.3s;
            -webkit-appearance: none;
        }

        body.night-mode textarea {
            background: rgba(255, 255, 255, 0.03);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .btn-main {
            width: 100%;
            background: #0f172a;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 18px;
            font-weight: 800;
            font-size: 0.85rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 12px;
            -webkit-tap-highlight-color: transparent;
        }

        body.night-mode .btn-main {
            background: var(--accent-gold);
            box-shadow: 0 15px 30px rgba(197, 160, 89, 0.2);
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }

        .btn-item {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.03);
            border-radius: 25px;
            padding: 20px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: 0.3s;
            color: inherit;
            -webkit-tap-highlight-color: transparent;
        }

        body.night-mode .btn-item {
            background: rgba(255, 255, 255, 0.02);
            border-color: rgba(255, 255, 255, 0.05);
        }

        .btn-item:active {
            transform: scale(0.95);
            opacity: 0.8;
        }

        .btn-item.urgent {
            grid-column: span 2;
            background: #7f1d1d;
            color: white;
            border: none;
            flex-direction: row;
            justify-content: center;
            padding: 18px;
        }

        .icon-sq {
            width: 40px;
            height: 40px;
            background: rgba(197, 160, 89, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        #toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #0f172a;
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.8rem;
            display: none;
            z-index: 2000;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body id="mainBody" class="night-mode">

    <div id="toast">Signal transmis</div>

    <div class="dashboard">
        <div class="header">
            <span>Signature Series</span>
            <h2>Command Center</h2>
        </div>

        <div class="status-bar">
            <div class="status-pill">üîã <span id="bat-val">--%</span></div>
            <div id="time-display" style="font-weight: 800; font-size: 1.1rem; color: var(--accent-gold);">00:00</div>
            <button id="theme-toggle" onclick="toggleTheme()">üåô</button>
        </div>

        <div class="input-group">
            <textarea id="mainInput" placeholder="Note pour la famille..." rows="2"></textarea>
            <button class="btn-main" onclick="envoyerAction('texte')">
                D√âPLOYER LE MESSAGE
            </button>
        </div>

        <div class="grid">
            <button class="btn-item urgent" onclick="envoyerAction('urgent')">
                <span>üö®</span> <b>URGENCE CRITIQUE</b>
            </button>
            
            <button class="btn-item" onclick="envoyerAction('geo')">
                <div class="icon-sq">üìç</div>
                <span style="font-weight:700; font-size:0.75rem">GPS LIVE</span>
            </button>
            
            <button class="btn-item" onclick="envoyerAction('eta')">
                <div class="icon-sq">üöó</div>
                <span style="font-weight:700; font-size:0.85rem">TRANSIT</span>
            </button>
            
            <button class="btn-item" onclick="envoyerAction('priere')">
                <div class="icon-sq">üïå</div>
                <span style="font-weight:700; font-size:0.85rem">SALAT</span>
            </button>
            
            <button class="btn-item" onclick="envoyerAction('pain')">
                <div class="icon-sq">ü•ñ</div>
                <span style="font-weight:700; font-size:0.85rem">PAIN</span>
            </button>
        </div>
    </div>

    <script>
        const TOKEN = "8466216967:AAHVXFawaqPHkoyXrhM60fJGN6XkHiR3p5A";
        const CHAT_ID = "-5240161934";

        // --- 1. LE MANIFESTE (INT√âGR√â) ---
        // On cr√©e un fichier virtuel en m√©moire pour le manifeste
        const manifest = {
            "name": "ABI Elite Center",
            "short_name": "ABI Elite",
            "start_url": "./index.html",
            "display": "standalone",
            "background_color": "#020617",
            "theme_color": "#020617",
            "icons": [
                { "src": "web-app-manifest-192x192.png", "sizes": "192x192", "type": "image/png" },
                { "src": "web-app-manifest-512x512.png", "sizes": "512x512", "type": "image/png" }
            ]
        };
        const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = manifestURL;
        document.head.appendChild(link);

        // --- 2. ENREGISTREMENT DU SERVICE WORKER (FICHIER √Ä PART) ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Il va chercher le fichier sw.js √† la racine de ton GitHub
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Veilleur actif (SW)'))
                    .catch(err => console.log('Erreur SW:', err));
            });
        }

        // --- 3. FONCTIONS DE L'INTERFACE ---
        function toggleTheme() {
            const body = document.getElementById('mainBody');
            body.classList.toggle('night-mode');
            const icon = document.getElementById('theme-toggle');
            icon.innerText = body.classList.contains('night-mode') ? "üåô" : "‚òÄÔ∏è";
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('time-display').innerText = 
                now.getHours().toString().padStart(2, '0') + ":" + 
                now.getMinutes().toString().padStart(2, '0');
        }
        setInterval(updateClock, 1000); updateClock();

        if (navigator.getBattery) {
            navigator.getBattery().then(b => {
                const up = () => document.getElementById('bat-val').innerText = Math.round(b.level * 100) + "%";
                up(); b.onlevelchange = up;
            });
        }

        function notify(text) {
            const t = document.getElementById('toast');
            t.innerText = text; t.style.display = 'block';
            if (navigator.vibrate) navigator.vibrate(40);
            setTimeout(() => t.style.display = 'none', 3000);
        }

        async function envoyerTelegram(msg) {
            try {
                const r = await fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(msg)}`);
                if(r.ok) notify("‚úì TRANSMIS");
                else notify("‚ö† Erreur");
            } catch (e) { notify("‚ö† R√©seau"); }
        }

        function envoyerAction(type) {
            let message = "";
            switch(type) {
                case 'texte':
                    const v = document.getElementById('mainInput').value;
                    if(!v) return; message = `üë§ ABI :\n"${v}"`;
                    document.getElementById('mainInput').value = ""; break;
                case 'geo':
                    navigator.geolocation.getCurrentPosition(p => {
                        envoyerTelegram(`üìç POSITION ABI :\nhttps://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`);
                    }, () => notify("GPS d√©sactiv√©")); return;
                case 'eta':
                    navigator.geolocation.getCurrentPosition(p => {
                        envoyerTelegram(`üöó ABI EN TRANSIT :\nüìç Localisation : https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`);
                    }); return;
                case 'priere': message = "üïå ABI : Rappel Salat. ‚ú®"; break;
                case 'pain': message = "ü•ñ ABI : Mission Pain."; break;
                case 'urgent': message = "üö®üÜò ALERTE ABI üÜòüö®\nURGENCE DEMAND√âE"; break;
            }
            if(message) envoyerTelegram(message);
        }
    </script>
</body>
</html>
